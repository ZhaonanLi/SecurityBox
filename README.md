## SecurityBox
### Security Cloud File Storage System.

##### System:
```json
Language:
    [1] C++ 11
    [2] PHP 5.4
Library: 
    [1] STL
    [2] Boost
    [3] Crypto++
    [4] Qt 5.4
Network:
    [1] Protocol: HTTP1.1.
    [2] IP Version: IPv4.
HTTP Server:
    [1] Apache2
Time-Server: 
    [1] Host: NTP
Host:
    [1] Hostname: 104.236.9.176
    [2] port_num: 9090
```

##### Security Algorithms:
```json
[1] Asymmetric encryption scheme: RSA.
[2] symmetric encryption scheme: AES(CBC).
[3] Hash: SHA-2.
[4] Digital Signature: DSA.
```

##### Security Arguments:
```json
[1] Timestamp: 
    (1) format: 
        (1) format string is "dmYHis".
        (2) format description: number sequence.
        (3) example: "1430485830"
    (2) time difference threshold: 60 （which = 60 seconds）.
````

##### Operation:
```json
[1] query server rsa public key
[2] upload client rsa public key
[3] list
[4] upload file
[5] download file
```
<hr>
##### Plaintext package format:

* (a) Request:
```
    No outer layer json.
```

* (b) Response:
```
   No outer layer json. 
```
<hr>
##### Security package format:

Asymmetric Encryption:

* (a) Request:
`Note: HMAC is generated by rsa_encrypted_package.`
```json
    {
        "HMAC":"xxxxxxx",
        "HMAC_key":"xxxxxxx",
        "signature":"xxxxxxxx",
        "DSA_public_key":"xxxxxxx",
        "rsa_encrypted_package":"xxxxxx"
    }
```
* (b) Response:
```
Note: [1] HMAC is generated by (rsa_encrypted_package + 
                                security_error_code +
                                security_error_message)
      [2] "+" sign means "string append" operation, 
          there is no space between two strings during applying "string append" operation.
```
```json
    {
        "HMAC":"xxxxxxx",
        "HMAC_key":"xxxxxx",
        "signature":"xxxxxxxx",
        "DSA_public_key":"xxxxxxx",
        "rsa_encrypted_package":"xxxxxx"
    }
```

Symmetric Encryption:

* (a) Request:
`Note: HMAC is generated by symmetric_encrypted_package.`
```json
    {
        "HMAC":"xxxxxx",
        "HMAC_key":"xxxxxxxx",
        "signature":"xxxxxx",
        "DSA_public_key":"xxxxxx",
        "symmetric_encrypted_package":"xxxxxxxxxx"
    }
```
* (b) Response:
```
Note: [1] HMAC is generated by (symmetric_encrypted_package +
                                security_error_code +
                                security_error_message)
      [2] "+" sign means "string append" operation, 
          there is no space between two strings during applying "string append" operation.
```
```json
    {
        "HMAC":"xxxxxxx",
        "HMAC_key":"xxxxxxxx",
        "signature":"xxxxx",
        "DSA_public_key":"xxxxxx",
        "symmetric_encrypted_package":"xxxxxx"
    }
```
<hr>
##### Operation package format:
`All URL based on RESTful API Rules`

[1] query server rsa public key:`[plaintext transmission]`
```
    Note: This operation should be executed before all other operations.
```
* (a) Request:
```json
    URL: http://hostname:port_num/security_box_api/server_rsa_public_key.php
    
    JSON:
    {
        "timestamp":"xxxxxxx"
    }
```
* (b) Response:
```json
    {
        "server_rsa_public_key":"xxxxxxx",
        "timestamp":"xxxxx",
        "error_code":"XXX",
        "error_message":"xxxxxxxx"
    }
```

[2] upload client rsa public key`[RSA encryption]`:
* (a) Request:
```json
    URL: "http://hostname:port_num/security_box_api/upload_client_rsa_public_key_service.php"
    
    JSON
    {
        "client_rsa_public_key":"xxxxxxx",
        "timestamp":"xxxxxxx"
    }
```
* (b) Response:
```json
    {
        "AES_key":"xxxxxxx",
        "AES_iv":"xxxxxxxx",
        "timestamp":"xxxxxx",
        "error_code":"XXX",
        "error_message":"xxxxxxxx",
        "security_error_code":"XXX",
        "security_error_message":"xxxxxxx"
    }
```

[4] list:`[AES encryption]`
* (a) Request:
```json
    URL: http://hostname:port_num/security_box_api/list_service.php
    
    JSON:
    {
        "timestamp":"xxxxxx"
    }
```
* (b) Response:
```json
    {
        "filename_list":[
            "xxxxxx",
            "xxxxxxx",
            "xxxxx"
        ],
        "timestamp":"xxxxxxxxx",
        "error_code":"XXX",
        "error_message":"xxxxxxx",
        "security_error_code":"XXX",
        "security_error_message":"xxxxxxx"
    }
```

[4] upload file:`[AES encryption]`
* (a) Request:
```json
    URL: http://hostname:port_num/security_box_api/upload_file_service.php

    JSON
    {
        "filename":"xxxxxx",
        "file_content":"xxxxxxxxx",
        "timestamp":"xxxxxx"
    }
```
* (b) Response:
```json
    {
        "timestamp":"xxxxxxx",
        "error_code":"XXX",
        "error_message":"xxxxxxx",
        "security_error_code":"XXX",
        "security_error_message":"xxxxxxx"
    }
```

[5] download file:`[AES encryption]`
* (a) Request:
```json
    URL: http://hostname:port_num/security_box_api/file.php

    JSON
    {
        "filename":"xxxxxxx",
        "timestamp":"xxxxxx"
    }
```
* (b) Response:
```json
    {
        "file_content":"xxxxxxx",
        "timestamp":"xxxxx",
        "error_code":"XXX",
        "error_message":"xxxxxxx",
        "security_error_code":"XXX",
        "security_error_message":"xxxxxxx"
    }
```
<hr>
##### error_code(type = string) --> error_message(type = string):

* "0": no error.
* "1": server cannot answer server's rsa public key.
* "2": server cannot get client rsa public key.
* "3": server cannot generate symmetric key.
* "4": server cannot retrieve filename list.
* "5": server cannot find file based on given filename.
* "6": filename conflict.
* "7": request error.
* "8": unknown error.
<hr>
##### security_error_code --> security_error_message:

* "0": no error.
* "1": HMAC does not match.
* "2": signature does not match.
* "3": decrypt error.
* "4": timestamp does not satisfy. 
* "5": request error.
* "6": unknown error.
